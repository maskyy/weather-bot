# weather-bot - тестовое задание
Telegram-бот для получения текущей температуры и скорости ветра через [OpenWeatherMap](https://openweathermap.org).

Так как API разрешает до 1000 вызовов в сутки, количество запросов в секунду также ограничено до 4 с помощью библиотеки [limiter](https://pypi.org/project/limiter/), а количество запрашиваемых городов - до 10.

## Примеры запросов и ответов
- `/start`, `/help` - получение справки
```
/start, /help - вывод этой команды

место1;...;место1 - получение погоды городов (до 10)
Примеры запросов:
1. Москва
2. Moscow; London; Paris
3. 1;2;3;4;5;6;7;8;9;10;11
4. notfound

Ответы:
1.
Город: Moscow, RU (Москва)
Температура: 30.96 °C
Скорость ветра: 5.43 м/с

2.
Город: Moscow, RU (Москва)
Температура: 31.15 °C
Скорость ветра: 5.43 м/с

Город: London, GB (Лондон)
Температура: 17.53 °C
Скорость ветра: 0.89 м/с

Город: Paris, FR (Париж)
Температура: 21.13 °C
Скорость ветра: 4.63 м/с

3. Пожалуйста, укажите не более 10 городов

4. Ошибка: место notfound не найдено
```
- `место1;место2;место3` - запрос на получение погоды одного или нескольких городов (до 10). См. примеры выше

Критические ошибки:
1. Failed to connect to DB - ошибка подключения к БД (неправильная строка подключения или недоступность сервера)
2. Cannot run bot - ошибка запуска бота (неверный токен)

Пользовательские сообщения:
1. Сервис погоды недоступен - исчерпание попыток подключиться к сервису погоды
2. Место не найдено :)
3. Место: ... - иные ошибки в поиске координат локации
4. Получение погоды: ... - ошибки в получении погоды
5. Пожалуйста, укажите не более N городов

## Установка
1. Установить сервер PostgreSQL (или поднять на Docker)
2. Установить poetry: `pip install poetry`
3. Зайти в папку проекта и активировать окружение: `poetry shell`
4. Установить зависимости: `poetry install --only main`

## Запуск
1. Указать переменные в .env:
  - `LOG_LEVEL` - уровень логирования (DEBUG, INFO, WARNING, ERROR, CRITICAL)
  - `BOT_TOKEN` - токен бота
  - `POSTGRES_{USER,PASSWORD,HOST,PORT,DB}` - подключение к БД
  - `WEATHER_API_TOKEN` - API-токен OpenWeatherMap
2. Из окружения выполнить команду `./run.sh` либо `python -m bot`. Либо запустить `docker-compose up`
